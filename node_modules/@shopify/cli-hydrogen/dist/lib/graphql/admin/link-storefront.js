import { adminRequest, parseGid } from '../../graphql.js';
import { getAdminSession } from '../../admin-session.js';

const LinkStorefrontQuery = `#graphql
  query LinkStorefront {
    hydrogenStorefronts {
      id
      title
      productionUrl
    }
  }
`;
async function getStorefronts(shop) {
  const adminSession = await getAdminSession(shop);
  const { hydrogenStorefronts } = await adminRequest(
    LinkStorefrontQuery,
    adminSession
  );
  return {
    adminSession,
    storefronts: hydrogenStorefronts.map((storefront) => ({
      ...storefront,
      parsedId: parseGid(storefront.id)
    }))
  };
}

export { LinkStorefrontQuery, getStorefronts };
