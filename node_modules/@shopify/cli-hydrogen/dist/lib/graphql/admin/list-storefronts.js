import { adminRequest, parseGid } from '../../graphql.js';
import { getAdminSession } from '../../admin-session.js';

const ListStorefrontsQuery = `#graphql
  query ListStorefronts {
    hydrogenStorefronts {
      id
      title
      productionUrl
      currentProductionDeployment {
        id
        createdAt
        commitMessage
      }
    }
  }
`;
async function getStorefrontsWithDeployment(shop) {
  const adminSession = await getAdminSession(shop);
  const { hydrogenStorefronts } = await adminRequest(
    ListStorefrontsQuery,
    adminSession
  );
  return {
    adminSession,
    storefronts: hydrogenStorefronts.map((storefront) => ({
      ...storefront,
      parsedId: parseGid(storefront.id)
    }))
  };
}

export { getStorefrontsWithDeployment };
